<div class="container my-5" *ngIf="productDetails; else loading">
  <div class="row">
    <!-- Colonna immagine -->
    <div class="col-md-5">
      <img
        [src]="productDetails.thumbnail"
        [alt]="productDetails.title"
        class="img-fluid rounded shadow-sm"
      />
      <!-- Galleria immagini -->
      <div class="mt-3 d-flex gap-2 flex-wrap">
        <img
          *ngFor="let image of productDetails.images"
          [src]="image"
          [alt]="productDetails.title"
          class="img-thumbnail"
          style="width: 80px; height: 80px; object-fit: cover; cursor: pointer"
        />
      </div>
    </div>

    <!-- Colonna dettagli prodotto -->
    <div class="col-md-7">
      <h1 class="h4">{{ productDetails.title }}</h1>
      <p class="text-muted">{{ productDetails.category | titlecase }}</p>

      <!-- Rating -->
      <div class="d-flex align-items-center mb-3">
        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
          <i
            class="fas"
            [ngClass]="getStarIcon(star, productDetails.rating)"
            style="color: gold"
          ></i>
        </ng-container>
        <span class="ms-2 text-muted"
          >({{ productDetails.rating }} rating)</span
        >
      </div>

      <!-- Prezzo -->
      <div class="mb-3">
        <h2 class="text-danger fw-bold">
          {{
            productDetails.price -
              productDetails.price * (productDetails.discountPercentage / 100)
              | currency
          }}
        </h2>
        <span class="text-muted ms-2">
          <del>{{ productDetails.price | currency }}</del>
        </span>
        <small class="text-success ms-2"
          >-{{ productDetails.discountPercentage }}%</small
        >
      </div>

      <!-- Dettagli -->
      <ul class="list-unstyled">
        <li><strong>Brand:</strong> {{ productDetails.brand }}</li>
        <li><strong>SKU:</strong> {{ productDetails.sku }}</li>
        <li>
          <strong>Dimensions:</strong>
          {{ productDetails.dimensions.width }} x
          {{ productDetails.dimensions.height }} x
          {{ productDetails.dimensions.depth }} cm
        </li>
        <li><strong>Weight:</strong> {{ productDetails.weight }} g</li>
        <li>
          <strong>Warranty:</strong> {{ productDetails.warrantyInformation }}
        </li>
      </ul>

      <!-- DisponibilitÃ  -->
      <p
        class="mt-3"
        [ngClass]="{
          'text-danger fw-bold': productDetails.stock < 10,
          'text-success fw-bold': productDetails.stock >= 10
        }"
      >
        {{ productDetails.availabilityStatus }}
      </p>

      <!-- Pulsante acquisto -->
      <button
        class="btn btn-primary mt-3"
        [disabled]="productDetails.stock === 0"
        (click)="addToCart(productDetails)"
      >
        Add to Cart
      </button>
      <p class="text-muted mt-2">
        Min. Order: {{ productDetails.minimumOrderQuantity }}
      </p>
    </div>
  </div>

  <!-- Recensioni -->
  <div class="row mt-5">
    <div class="col-12">
      <h2 class="h5">Customer Reviews</h2>
      <div
        *ngFor="let review of productDetails.reviews"
        class="border-bottom py-3"
      >
        <div class="d-flex align-items-center mb-2">
          <!-- Stelle della recensione -->
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
            <i
              class="fas"
              [ngClass]="getStarIcon(star, review.rating)"
              style="color: gold"
            ></i>
          </ng-container>
          <span class="ms-2 text-muted">({{ review.rating }})</span>
        </div>
        <p class="mb-1">{{ review.comment }}</p>
        <small class="text-muted">
          By {{ review.reviewerName }} on {{ review.date | date : "longDate" }}
        </small>
      </div>
    </div>
  </div>
</div>
<div class="container-auto  bg-body-tertiary">
  
  <div id="productCarousel" class="carousel slide" data-bs-ride="carousel">
    <!-- Indicatori -->
    <div class="carousel-indicators">
      <button
        type="button"
        data-bs-target="#productCarousel"
        data-bs-slide-to="0"
        class="active"
        aria-current="true"
        aria-label="Slide 1"
      ></button>
      <button
        *ngFor="let product of allProducts.slice(1); let i = index"
        type="button"
        data-bs-target="#productCarousel"
        [attr.data-bs-slide-to]="i + 1"
        [attr.aria-label]="'Slide ' + (i + 2)"
      ></button>
    </div>

    <!-- Contenuto del carosello -->
    <div class="carousel-inner">
      <div
        *ngFor="let product of allProducts; let i = index"
        class="carousel-item"
        [class.active]="i === 0"
      >
        <a [routerLink]="['/product', product.id]" class="text-decoration-none">
          <div class="d-flex justify-content-center">
            <div class="card my-4" style="width: 18rem;">
              <img
                [src]="product.images[0]"
                [alt]="product.title"
                class="card-img-top"
                style="height: 200px; object-fit: contain;"
              />
              <div class="card-body text-center">
                <h6 class="card-title">{{ product.title }}</h6>
                <p class="card-text text-danger fw-bold">
                  {{ product.price | currency }}
                </p>
              </div>
            </div>
          </div>
        </a>
      </div>
    </div>

   <!-- Controlli -->
<button
  class="carousel-control-prev"
  type="button"
  data-bs-target="#productCarousel"
  data-bs-slide="prev"
>
  <span aria-hidden="true" class="fw-bold fs-3">&lt;</span> <!-- Freccia sinistra -->
  <span class="visually-hidden">Previous</span>
</button>
<button
  class="carousel-control-next"
  type="button"
  data-bs-target="#productCarousel"
  data-bs-slide="next"
>
  <span aria-hidden="true" class="fw-bold fs-3">&gt;</span> <!-- Freccia destra -->
  <span class="visually-hidden">Next</span>
</button>

  </div>
</div>


<!-- Placeholder per caricamento -->
<ng-template #loading>
  <div class="text-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-3">Loading product details...</p>
  </div>
</ng-template>
