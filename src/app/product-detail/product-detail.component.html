<div class="container my-5" *ngIf="productDetails; else loading">
  <div class="row">
    <!-- Colonna immagine -->
    <div class="col-md-5">
      <img
        [src]="productDetails.thumbnail"
        [alt]="productDetails.title"
        class="img-fluid rounded shadow-sm"
      />
      <!-- Galleria immagini -->
      <div class="mt-3 d-flex gap-2 flex-wrap">
        <img
          *ngFor="let image of productDetails.images"
          [src]="image"
          [alt]="productDetails.title"
          class="img-thumbnail"
          style="width: 80px; height: 80px; object-fit: cover; cursor: pointer"
        />
      </div>
    </div>

    <!-- Colonna dettagli prodotto -->
    <div class="col-md-7">
      <h1 class="h4">{{ productDetails.title }}</h1>
      <p class="text-muted">{{ productDetails.category | titlecase }}</p>

      <!-- Rating -->
      <div class="d-flex align-items-center mb-3">
        <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
          <i
            class="fas"
            [ngClass]="getStarIcon(star, productDetails.rating)"
            style="color: gold"
          ></i>
        </ng-container>
        <span class="ms-2 text-muted"
          >({{ productDetails.rating }} rating)</span
        >
      </div>

      <!-- Prezzo -->
      <div class="mb-3">
        <h2 class="text-danger fw-bold">
          {{
            productDetails.price -
              productDetails.price * (productDetails.discountPercentage / 100)
              | currency
          }}
        </h2>
        <span class="text-muted ms-2">
          <del>{{ productDetails.price | currency }}</del>
        </span>
        <small class="text-success ms-2"
          >-{{ productDetails.discountPercentage }}%</small
        >
      </div>

      <!-- Dettagli -->
      <ul class="list-unstyled">
        <li><strong>Brand:</strong> {{ productDetails.brand }}</li>
        <li><strong>SKU:</strong> {{ productDetails.sku }}</li>
        <li>
          <strong>Dimensions:</strong>
          {{ productDetails.dimensions.width }} x
          {{ productDetails.dimensions.height }} x
          {{ productDetails.dimensions.depth }} cm
        </li>
        <li><strong>Weight:</strong> {{ productDetails.weight }} g</li>
        <li>
          <strong>Warranty:</strong> {{ productDetails.warrantyInformation }}
        </li>
      </ul>

      <!-- DisponibilitÃ  -->
      <p
        class="mt-3"
        [ngClass]="{
          'text-danger fw-bold': productDetails.stock < 10,
          'text-success fw-bold': productDetails.stock >= 10
        }"
      >
        {{ productDetails.availabilityStatus }}
      </p>

      <!-- Pulsante acquisto -->
      <button
        class="btn btn-primary mt-3"
        [disabled]="productDetails.stock === 0"
        (click)="addToCart(productDetails)"
      >
        Add to Cart
      </button>
      <p class="text-muted mt-2">
        Min. Order: {{ productDetails.minimumOrderQuantity }}
      </p>
    </div>
  </div>

  <!-- Recensioni -->
  <div class="row mt-5">
    <div class="col-12">
      <h2 class="h5">Customer Reviews</h2>
      <div
        *ngFor="let review of productDetails.reviews"
        class="border-bottom py-3"
      >
        <div class="d-flex align-items-center mb-2">
          <!-- Stelle della recensione -->
          <ng-container *ngFor="let star of [1, 2, 3, 4, 5]">
            <i
              class="fas"
              [ngClass]="getStarIcon(star, review.rating)"
              style="color: gold"
            ></i>
          </ng-container>
          <span class="ms-2 text-muted">({{ review.rating }})</span>
        </div>
        <p class="mb-1">{{ review.comment }}</p>
        <small class="text-muted">
          By {{ review.reviewerName }} on {{ review.date | date : "longDate" }}
        </small>
      </div>
    </div>
  </div>
</div>

<!-- Placeholder per caricamento -->
<ng-template #loading>
  <div class="text-center my-5">
    <div class="spinner-border text-primary" role="status"></div>
    <p class="mt-3">Loading product details...</p>
  </div>
</ng-template>
